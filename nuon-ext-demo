#!/usr/bin/env bash
set -euo pipefail

EXT_DIR="${NUON_EXT_DIR:-$(cd "$(dirname "$(readlink -f "$0" 2>/dev/null || realpath "$0" 2>/dev/null || echo "$0")")" && pwd)}"
SCRIPTS_DIR="$EXT_DIR/scripts"

usage() {
  echo "Usage: nuon demo <command> [args...]"
  echo ""
  echo "Commands:"
  for script in "$SCRIPTS_DIR"/*; do
    [ -x "$script" ] || continue
    name="$(basename "$script")"
    echo "  $name"
  done
}

if [ $# -eq 0 ] || [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
  usage
  exit 0
fi

command="$1"
shift

script="$SCRIPTS_DIR/$command"
if [ ! -x "$script" ]; then
  echo "Error: unknown command '$command'" >&2
  echo "" >&2
  usage >&2
  exit 1
fi

exec "$script" "$@"
